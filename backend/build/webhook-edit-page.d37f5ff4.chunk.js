"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[3881],{31479:(G,y,t)=>{t.r(y),t.d(y,{default:()=>b});var e=t(21272),D=t(51337),E=t(69267),A=t(71526),k=t(45944);const b=()=>{const d=(0,E.d4)(A.G);return e.createElement(D.kz,{permissions:d.settings.webhooks.create},e.createElement(k.A,null))}},45944:(G,y,t)=>{t.d(y,{A:()=>fe});var e=t(21272),D=t(38413),E=t(51337),A=t(74930),k=t(17703),Q=t(30420),b=t(55356),d=t(83997),ne=t(85963),ae=t(4198),H=t(94061),N=t(90151),R=t(68074),Y=t(7537),ie=t(98052),f=t(54514),Z=t(46270),T=t(2506),de=t(33544),g=t.n(de),x=t(54894),re=t(88022),J=t(67070);function _(){return e.createElement(J.A.Root,null,e.createElement(J.A.Headers,null),e.createElement(J.A.Body,null))}var oe=t(8361),q=t(18629),ee=t(5194),ce=t(76517),F=t(80782);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],n=({name:s,onChange:a,value:r,...i})=>{const{values:{headers:h}}=(0,T.j7)(),[P,l]=(0,e.useState)(le);(0,e.useEffect)(()=>{l(le.filter(p=>!h?.some(j=>j.key!==r&&j.key===p)))},[h,r]);const w=p=>{a({target:{name:s,value:p}})},X=p=>{l(j=>[...j,p]),w(p)};return e.createElement(ce.nP,{...i,onClear:()=>w(""),onChange:w,onCreateOption:X,placeholder:"",value:r},P.map(p=>e.createElement(F.j,{value:p,key:p},p)))};n.defaultProps={value:void 0},n.propTypes={name:g().string.isRequired,onChange:g().func.isRequired,value:g().string};const o=n,v=()=>{const{formatMessage:s}=(0,x.A)(),{values:a,errors:r}=(0,T.j7)();return e.createElement(d.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(oe.d,null,s({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(H.a,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(T.ED,{validateOnChange:!1,name:"headers",render:({push:i,remove:h})=>e.createElement(N.x,{gap:4},a.headers.map((P,l)=>e.createElement(e.Fragment,{key:`${l}.${P.key}`},e.createElement(R.E,{col:6},e.createElement(T.D0,{as:o,name:`headers.${l}.key`,"aria-label":`row ${l+1} key`,label:s({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:r.headers?.[l]?.key&&r.headers[l].key})),e.createElement(R.E,{col:6},e.createElement(d.s,{alignItems:"flex-end"},e.createElement(H.a,{style:{flex:1}},e.createElement(T.D0,{as:Y.k,name:`headers.${l}.value`,"aria-label":`row ${l+1} value`,label:s({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:r.headers?.[l]?.value&&r.headers[l].value})),e.createElement(d.s,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:r.headers?.[l]?.value?0:5},e.createElement(E.yX,{disabled:a.headers.length===1,onClick:()=>h(l),label:s({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:l+1})})))))),e.createElement(R.E,{col:12},e.createElement(q.Q,{type:"button",onClick:()=>{i({key:"",value:""})},startIcon:e.createElement(ee.A,null)},s({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var u=t(30893),W=t(84795),S=t(68802),z=t(63891);const K=z.Ay.svg(({theme:s,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${s.colors[a]};
  }
`),B=({isPending:s,statusCode:a})=>{const{formatMessage:r}=(0,x.A)();return s?e.createElement(d.s,{gap:2,alignItems:"center"},e.createElement(K,{as:W.A}),e.createElement(u.o,null,r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(d.s,{gap:2,alignItems:"center"},e.createElement(K,{as:f.A,color:"success700"}),e.createElement(u.o,null,r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(d.s,{gap:2,alignItems:"center"},e.createElement(K,{as:S.A,color:"danger700"}),e.createElement(u.o,null,r({id:"Settings.error",defaultMessage:"error"})," ",a)):null};B.propTypes={isPending:g().bool.isRequired,statusCode:g().number},B.defaultProps={statusCode:void 0};const $=({statusCode:s,message:a})=>{const{formatMessage:r}=(0,x.A)();return s>=200&&s<300?e.createElement(d.s,{justifyContent:"flex-end"},e.createElement(u.o,{textColor:"neutral600",ellipsis:!0},r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):s>=300?e.createElement(d.s,{justifyContent:"flex-end"},e.createElement(d.s,{maxWidth:(0,E.a8)(250),justifyContent:"flex-end",title:a},e.createElement(u.o,{ellipsis:!0,textColor:"neutral600"},a))):null};$.propTypes={statusCode:g().number,message:g().string},$.defaultProps={statusCode:void 0,message:void 0};const M=({onCancel:s})=>{const{formatMessage:a}=(0,x.A)();return e.createElement(d.s,{justifyContent:"flex-end"},e.createElement("button",{onClick:s,type:"button"},e.createElement(d.s,{gap:2,alignItems:"center"},e.createElement(u.o,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(K,{as:S.A,color:"neutral400"}))))};M.propTypes={onCancel:g().func.isRequired};const m=({isPending:s,onCancel:a,response:r})=>{const{statusCode:i,message:h}=r,{formatMessage:P}=(0,x.A)();return e.createElement(H.a,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(N.x,{gap:4,style:{alignItems:"center"}},e.createElement(R.E,{col:3},e.createElement(u.o,null,P({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(R.E,{col:3},e.createElement(B,{isPending:s,statusCode:i})),e.createElement(R.E,{col:6},s?e.createElement(M,{onCancel:a}):e.createElement($,{statusCode:i,message:h}))))};m.defaultProps={isPending:!1,onCancel(){},response:{}},m.propTypes={isPending:g().bool,onCancel:g().func,response:g().object};const O=m;var C=t(12083);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:s})=>C.Ik().shape({name:C.Yj().required(s({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,s({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:C.Yj().required(s({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,s({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:C.RZ(a=>{let r=C.YO();if(a.length===1){const{key:i,value:h}=a[0];if(!i&&!h)return r}return r.of(C.Ik().shape({key:C.Yj().required(s({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:C.Yj().required(s({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:C.YO()}),ue=({handleSubmit:s,triggerWebhook:a,isCreating:r,isTriggering:i,triggerResponse:h,data:P})=>{const{formatMessage:l}=(0,x.A)(),[w,X]=(0,e.useState)(!1),p=(0,re.h)(_,async()=>(await t.e(2785).then(t.bind(t,7547))).EventTableEE),j=U=>Object.keys(U).length?Object.entries(U).map(([te,se])=>({key:te,value:se})):[{key:"",value:""}],I=(0,T.Wx)({initialValues:{name:P?.name||"",url:P?.url||"",headers:j(P?.headers||{}),events:P?.events||[]},onSubmit(U,{resetForm:te,setSubmitting:se}){s(U),te({values:U}),se(!1)},validationSchema:he({formatMessage:l}),validateOnChange:!1,validateOnBlur:!1});return p?e.createElement(T.QI,{value:I},e.createElement(E.lV,{onSubmit:I.handleSubmit},e.createElement(b.Q,{primaryAction:e.createElement(d.s,{gap:2},e.createElement(ne.$,{onClick:()=>{a(),X(!0)},variant:"tertiary",startIcon:e.createElement(ie.A,null),disabled:r||i,size:"L"},l({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(ne.$,{startIcon:e.createElement(f.A,null),type:"submit",size:"L",disabled:!I.dirty,loading:I.isSubmitting},l({id:"global.save",defaultMessage:"Save"}))),title:r?l({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):P?.name,navigationAction:e.createElement(E.N_,{startIcon:e.createElement(Z.A,null),to:"/settings/webhooks"},l({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ae.s,null,e.createElement(d.s,{direction:"column",alignItems:"stretch",gap:4},w&&e.createElement(O,{isPending:i,response:h,onCancel:()=>X(!1)}),e.createElement(H.a,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(d.s,{direction:"column",alignItems:"stretch",gap:6},e.createElement(N.x,{gap:6},e.createElement(R.E,{col:6},e.createElement(T.D0,{as:Y.k,name:"name",error:I?.errors?.name&&I.errors.name,label:l({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(R.E,{col:12},e.createElement(T.D0,{as:Y.k,name:"url",error:I?.errors?.url&&I.errors.url,label:l({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(v,null),e.createElement(p,null))))))):null};ue.propTypes={data:g().object,handleSubmit:g().func.isRequired,triggerWebhook:g().func.isRequired,isCreating:g().bool.isRequired,isTriggering:g().bool.isRequired,triggerResponse:g().object},ue.defaultProps={data:void 0,triggerResponse:void 0};const pe=ue,me=s=>({...s,headers:s.headers.reduce((a,{key:r,value:i})=>(r!==""&&(a[r]=i),a),{})}),fe=()=>{const{params:{id:s}}=(0,k.W5)("/settings/webhooks/:id"),a=s==="create",{replace:r}=(0,k.W6)(),i=(0,E.hN)(),{formatAPIError:h}=(0,E.wq)(),P=(0,A.useQueryClient)(),{isLoading:l}=(0,Q.m)(),{put:w,get:X,post:p}=(0,E.ry)(),{isLoading:j,data:I,error:U}=(0,A.useQuery)(["webhooks",s],async()=>{const{data:{data:L}}=await X(`/admin/webhooks/${s}`);return L},{enabled:!a});e.useEffect(()=>{U&&i({type:"warning",message:h(U)})},[U,i,h]);const{isLoading:te,data:se,isIdle:ve,mutate:Me}=(0,A.useMutation)(()=>p(`/admin/webhooks/${s}/trigger`)),Ce=()=>Me(null,{onError(L){i({type:"warning",message:h(L)})}}),ye=(0,A.useMutation)(L=>p("/admin/webhooks",L)),Ae=(0,A.useMutation)(({id:L,body:V})=>w(`/admin/webhooks/${L}`,V)),Pe=async L=>{if(a){ye.mutate(me(L),{onSuccess({data:V}){i({type:"success",message:{id:"Settings.webhooks.created"}}),r(`/settings/webhooks/${V.data.id}`)},onError(V){i({type:"warning",message:h(V)})}});return}Ae.mutate({id:s,body:me(L)},{onSuccess(){P.invalidateQueries(["webhooks",s]),i({type:"success",message:{id:"notification.form.success.fields"}})},onError(V){i({type:"warning",message:h(V)})}})};return j||l?e.createElement(E.Bl,null):e.createElement(D.g,null,e.createElement(E.x7,{name:"Webhooks"}),e.createElement(pe,{data:I,handleSubmit:Pe,triggerWebhook:Ce,isCreating:a,isTriggering:te,isTriggerIdle:ve,triggerResponse:se?.data.data}))}},46270:(G,y,t)=>{t.d(y,{A:()=>E});var e=t(92132);const D=A=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...A,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),E=D},67070:(G,y,t)=>{t.d(y,{A:()=>le});var e=t(21272),D=t(50215),E=t(4181),A=t(8361),k=t(43064),Q=t(46462),b=t(81621),d=t(66809),ne=t(379),ae=t(84843),H=t(83997),N=t(30893),R=t(98765),Y=t(2506),ie=t(33544),f=t.n(ie),Z=t(54894),T=t(63891),de=t(30420);const g=n=>n.reduce((o,c)=>{const v=c.split(".")[0];return o[v]||(o[v]=[]),o[v].push(c),o},{}),x=(0,T.Ay)(Q.X)`
  tbody tr:nth-child(odd) {
    background: ${({theme:n})=>n.colors.neutral100};
  }

  thead th span {
    color: ${({theme:n})=>n.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:n})=>n.spaces[3]};
    padding-block-end: ${({theme:n})=>n.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:n})=>n.spaces[2]};
  }
`,re=n=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return n&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},J=n=>{const o=["entry.create","entry.update","entry.delete"];return n&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},_=e.createContext(),oe=({children:n})=>{const{formatMessage:o}=(0,Z.A)(),{collectionTypes:c,isLoading:v}=(0,de.m)(),u=e.useMemo(()=>c.some(S=>S.options.draftAndPublish===!0),[c]),W=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(_.Provider,{value:{isDraftAndPublish:u}},e.createElement(H.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(A.d,{"aria-hidden":!0},W),v&&e.createElement(k.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(x,{"aria-label":W},n)))};oe.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired};const q=({getHeaders:n=re})=>{const{isDraftAndPublish:o}=e.useContext(_),{formatMessage:c}=(0,Z.A)(),v=n(o);return e.createElement(d.r,null,e.createElement(ae.N,null,e.createElement(b.e,null,e.createElement(R.s,null,c({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),v.map(u=>["app.utils.publish","app.utils.unpublish"].includes(u.id)?e.createElement(b.e,{key:u.id,title:c({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(N.o,{variant:"sigma",textColor:"neutral600"},c(u))):e.createElement(b.e,{key:u.id},e.createElement(N.o,{variant:"sigma",textColor:"neutral600"},c(u))))))};q.defaultProps={getHeaders:re},q.propTypes={getHeaders:f().func};const ee=({providedEvents:n})=>{const{isDraftAndPublish:o}=e.useContext(_),c=n||J(o),{values:v,handleChange:u}=(0,Y.j7)(),W="events",S=v.events,z=[],K=g(S),B=({target:{name:M,value:m}})=>{let O=new Set(S);m?O.add(M):O.delete(M),u({target:{name:W,value:Array.from(O)}})},$=({target:{name:M,value:m}})=>{let O=new Set(S);m?c[M].forEach(C=>{z.includes(C)||O.add(C)}):c[M].forEach(C=>O.delete(C)),u({target:{name:W,value:Array.from(O)}})};return e.createElement(ne.f,null,Object.entries(c).map(([M,m])=>e.createElement(F,{disabledEvents:z,key:M,name:M,events:m,inputValue:K[M],handleSelect:B,handleSelectAll:$})))};ee.defaultProps={providedEvents:null},ee.propTypes={providedEvents:f().object};const ce=n=>n.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),F=({disabledEvents:n,name:o,events:c,inputValue:v,handleSelect:u,handleSelectAll:W})=>{const{formatMessage:S}=(0,Z.A)(),z=c.filter(m=>!n.includes(m)),K=v.length>0,B=v.length===z.length,$=({target:{name:m}})=>{W({target:{name:m,value:!B}})},M=5;return e.createElement(ae.N,null,e.createElement(b.N,null,e.createElement(E.S,{indeterminate:K&&!B,"aria-label":S({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:$,value:B},ce(o))),c.map(m=>e.createElement(b.N,{key:m},e.createElement(D.J,{disabled:n.includes(m),"aria-label":m,name:m,value:v.includes(m),onValueChange:O=>u({target:{name:m,value:O}})}))),c.length<M&&e.createElement(b.N,{colSpan:M-c.length}))};F.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},F.propTypes={disabledEvents:f().array,events:f().array,inputValue:f().array,handleSelect:f().func,handleSelectAll:f().func,name:f().string.isRequired};const le={Root:oe,Headers:q,Body:ee,EventRow:F}},80782:(G,y,t)=>{t.d(y,{j:()=>D});var e=t(76517);const D=e.c$},83807:(G,y,t)=>{t.r(y),t.d(y,{default:()=>b});var e=t(21272),D=t(51337),E=t(69267),A=t(71526),k=t(45944);const b=()=>{const d=(0,E.d4)(A.G);return e.createElement(D.kz,{permissions:d.settings.webhooks.update},e.createElement(k.A,null))}}}]);
